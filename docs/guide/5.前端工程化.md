---
order: 5
toc: menu
title: 5. 前端工程化
---

## 1. webpack

## base

### package.json

```js
yarn add webpack webpack-cli --save-dev
yarn add webpack-dev-server -D
yarn add html-webpack-plugin --save-dev

scripts: {
  "serve": "webpack serve "
  "build": "webpack",
}

├── dist
│   └── main.js
├── index.html
├── package.json
├── src
│   └── index.js
└── webpack.config.js


const path = require('path')
module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
  },
  mode: "development"
}
```

### webpack-dev-server

```javascript
yarn add webpack-dev-server -D
#
const path = require('path')
module.exports = {
    devServer: {
      // html页面的路径 (默认就是项目根路径)
      //  初始相对路径是webpack.config 如果dist和他同级
      // contentBase: './dist'
      contentBase: path.resolve(__dirname, 'build'),
      // 影响本地资源的访问  express.static
      // 是对 output 打包文件物理存储位置的映射
      publicPath: "/assets/",
      // 启动gzip压缩
      compress: true,
      port: 8088,
      open:true
    }
}
```

### html-webpack-plugin

```java
yarn add html-webpack-plugin -D
# webpack.config.js
  const HtmlWebpackPlugin = require('html-webpack-plugin')
 module.exports = {
         plugins: [
            new HtmlWebpackPlugin({
                template: './public/index.html'
                 //要生成的文件名 存在内存 目录中不显示
                filename: 'index.html',
                minify: {
                   // 移除空格
                   collapseWhitespace: true,
                   // 移除注释
                   removeComments: true
                }
            })
         ]
   }
```

## webpack loader

### css 和图片字体

- postcss
- 自动添加 css 的兼容前缀

```javascript
# postcss.config.js
  const autoprefixer = require('autoprefixer')
  module.exports = {
        plugins: [autoprefixer]
  }
#
{
  test: /\.css$/,
  use: ['style-loader', 'css-loader', 'postcss-loader'] },
```

- 样式表中的图片和字体文件
- /limit 用来指定图片的大小，单位是字节(byte),只有小于 limit 大小的图片，才会被转为 base64 图片

```javascript
#
// use 数组中指定的 loader 顺序是固定的
// 多个 loader 的调用顺序是：从后往前调用
   yarn add style-loader css-loader -D
   yarn add less-loader less -D
   yarn add sass-loader node-sass -D
   yarn add postcss-loader autoprefixer -D
   yarn add url-loader file-loader --save-dev
# 注意在 index.js中 import 各种css文件
# webpack.config.js  =>
module.exports = {
  module: {
    rules: [
       {
        test: /\.css$/,
        use: [
          'style-loader',
          'css-loader',
          'postcss-loader'
        ]
       },
      {
        test: /\.less$/,
        use: [
        'style-loader',
        'css-loader',
        'less-loader',
        ]
      },
      {
        test: /\.scss$/,
        use: [
          'style-loader',
          'css-loader',
          'sass-loader'
        ]
      },
      {
     test:/\.jpg|png|gif|bmp|ttf|eot|svg|woff|woff2$/,
        use: [
          'url-loader?limit=16941'
        ]
      },
      {
        test: /\.js$/,
        exclude: /(node_modules|bower_components)/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env']
          }
        }
      },
      {
        test: /\.vue$/,
        use: 'vue-loader'
      }
    ]
  }
}


# webpack 5
url-loader 可以不下载包 处理图片和字体图标
{ test: /\.(gif|png|jpg|jpeg)/,type: 'asset' },
{ test: /\.(eot|svg|ttf|woff|woff2)$/,type: 'asset/resource',
generator: { filename: 'fonts/[name].[hash:6][ext]' }}
//asset/resource 不压缩成base64  asset => base64
```

### 高级语法降级

```javascript
yarn add -D babel-loader @babel/core @babel/preset-env
{
  test: /\.js$/,
  exclude: /(node_modules|bower_components)/,
  use: {
    loader: 'babel-loader',
    options: {
      presets:  ['@babel/preset-env'] }
    }
  },
```

### vue-loader

- 安装加载器

```javascript
npm i vue-loader vue-template-compiler -D

const VueLoaderPlugin =
      require('vue-loader/lib/plugin')
rules: [
  { test: /\.vue$/, use: 'vue-loader' }
],
plugins: [htmlPlguin, new VueLoaderPlugin()]
```

### file-loader

```javascript
 yarn add file-loader -D
 use: {
   loader: "file-loader",
   options: {
     name: '[name]_[hash].[ext]',
     outputPath: "css/"
   }
 }
```

## 高级

### entry

```js
# 新建目录src
    默认入口: ./src/index.js
#
  多入口打包
  entry: {
    'jquery': './src/index.js',
    'angular': './src/2.js'
  },
# 根目录创建webpack.config.js
 // entry: string   生成一个chunk 输出一个 bundle
 // entry: sring[]  生成一个chunk 输出一个 bundle
 // entry: object   有几个入口文件就生成几个 chunk 和 bundle
module.exports = {
  entry: "./src/main.js",
}
```

### output

```js
  默认出口: ./dist/main.js
#
module.exports = {
  output: {
    path: path.join(__dirname, "dist"),
    filename: "bundle.js",
    // 资源公众路径前缀
    // images/a.jpg => /images/a.jpg
    publicPath: '/',
    chunkFilename: 'js/[name]_chunk.js',
    // 整个库向外保留的变量名
    library: '[name]'
    // 变量名添加到顶级作用域 global
    libraryTarget: 'window'
 },
}
```

### mode

```js
module.exports = {
  mode: 'development production',
};
```

### devServer

```js
module.exports = {
  port: 5000,
  host: 'localhost',
  open: true,
  hot: true,
  proxy: {
 /*
 本地 :5000 端口服务器接受到 /api/xxx 的请求
 就会把请求转发到另外一个服务器 :3000
 */
    '/api': {
       target: 'http://localhost:3000',
  // 请求路径重写：将 /api/xxx --> /xxx （去掉/api）
       pathRewrite: {
         '^/api': ''
       }
     }
  }

  // 不显示服务器日志信息
  clientLogLevel: 'none',
  // 除了一些基本启动信息以外，其他内容都不要显示
  quiet: true,
  // 如果报错 不要全屏提示
  overlay: false
  // 启动gzip压缩
  compress: true,
  watchContentBase: true,
  watchOptions: {
          // 忽略文件
          ignored: /node_modules/
  },

  # 4.0 webpack
  // 影响本地资源的访问  express.static
  // 是对 output 打包文件物理存储位置的映射
  publicPath: "/assets/",
  // html页面的路径 (默认就是项目根路径)
  // 初始相对路径是webpack.config 如果dist和他同级
  // contentBase: './dist'
  contentBase: resolve(__dirname, 'dist')
  // 监视 contentBase 目录下的所有文件 文件变化就会 reload
  # 5.0 webpack
  // 默认指定为 public 目录
  static: { //false
    directory: path.join(__dirname, 'assets'),
    publicPath: '/index.html',
  }
}
```

### module

### noParse

```js
module.exports = {
  // 防止 webpack 解析这些文件
  // 这些文件内不能含有 import require define
  // 可以提高性能
  module: {
    noParse: /jquery|lodash/,
  },
};
```

### rules

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.js$/
        // 排除 node_modules 下的js文件
        exclude: /node_modules/,
        // 只检查 src 下的js文件
        include: resolve(__dirname, 'scr'),
        // pre:优先执行 post:延后执行
        enforce: 'pre',
        loader: 'eslint-loader',
        options: { }
      },
      {
        // 当规则匹配时 只使用第一个成功的匹配规则
        oneOf: [
          {

          }
        ]
       }
    ]
  }
}
```

### oneOf

```js
// 当规则匹配时 只使用第一个成功的匹配规则
module.exports = {
  module: {
    rules: [
      {
        oneOf: [
          {
            test: /\.(jpg|png|gif)/,
            loader: 'url-loader',
            options: {
              limit: 8 * 1024,
              name: '[hash:10].[ext]',
              outputPath: 'imgs',
              esModule: false,
            },
          },
          {
            test: /\.html$/,
            loader: 'html-loader',
          },
          {
            exclude: /\.(js|css|less|html|jpg|png|gif)/,
            loader: 'file-loader',
            options: {
              outputPath: 'media',
            },
          },
        ],
      },
    ],
  },
};
```

### resolve

### alias

```js
const path = require('path');
module.exports = {
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@/components': path.resolve(__dirname, '..', 'src/components'),
      '@/utils': path.resolve(__dirname, '..', 'src/utils'),
      '@/services': path.resolve(__dirname, '..', 'src/services'),
      '@/models': path.resolve(__dirname, '..', 'src/models'),
      '@/pages': path.resolve(__dirname, '..', 'src/pages'),
    },
  },
};
```

### extensions modules

```js
module.exports = {
  resolve: {
    // 配置省略文件路径的后缀名
    extensions: ['.js','.json','.jsx','.css']
    // 告诉 webpack 解析模块去找那个目录
    modules: [
      resolve(__dirname, '../../node_modules'),
      'node_modules'
    ]
  }
}
```

### plugins

```js
module.exports = {
  plugins: [],
};
```

### externals

```js
// 拒绝 jqery 被打包
module.exports = {
  externals: {
    jquery: 'jQuery',
  },
  plugins: [
    new webpack.ProvidePlugin({
      $: 'jquery',
    }),
  ],
};
```

### Optimization

### splitChunks

```js
// 将 node_modules 中代码打包进一个 chunk
// 自动分析多入口 chunk 有没有公共文件 有的话会打包成单独一个 chunk
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all async',
    },
  },
};
```

### devtool

### source-map

```js
module.exports = {
  devtool: 'cheap-module-source-map'
}
#
source-map: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）

[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

      source-map：外部
        错误代码准确信息 和 源代码的错误位置
      inline-source-map：内联
        只生成一个内联source-map
        错误代码准确信息 和 源代码的错误位置
      hidden-source-map：外部
        错误代码错误原因，但是没有错误位置
        不能追踪源代码错误，只能提示到构建后代码的错误位置
      eval-source-map：内联
        每一个文件都生成对应的source-map，都在eval
        错误代码准确信息 和 源代码的错误位置
      nosources-source-map：外部
        错误代码准确信息, 但是没有任何源代码信息
      cheap-source-map：外部
        错误代码准确信息 和 源代码的错误位置
        只能精确的行
      cheap-module-source-map：外部
        错误代码准确信息 和 源代码的错误位置
        module会将loader的source map加入

    内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快

      开发环境：速度快，调试更友好
        速度快(eval>inline>cheap>...)
          eval-cheap-souce-map
          eval-source-map
        调试更友好
          souce-map
          cheap-module-souce-map
          cheap-souce-map

        --> eval-source-map  / eval-cheap-module-souce-map

      生产环境：源代码要不要隐藏? 调试要不要更友好
        内联会让代码体积变大，所以在生产环境不用内联
        nosources-source-map 全部隐藏
        hidden-source-map 只隐藏源代码，会提示构建后代码错误信息

        --> source-map / cheap-module-souce-map

```

## demo

### css 抽离

```js
plugins: [
   new MiniCssExtractPlugin({
     // 对输出的css文件进行重命名
     filename: 'css/built.css'
   }),
   // 压缩css
   new OptimizeCssAssetsWebpackPlugin()
]

#
  {
        test: /\.css$/,
        use: [ 'file-loader']
             ['file-loader?name=[name].bundle[hash].css']
  },
```

### js 抽离

```js
 output: {
    filename: 'js/[name].js',
    path: path.resolve(__dirname, 'dist'),
  },
```

### js 语法检查

```js
#
eslint eslint-loader
package.json 中添加
// 排除第三方库 只检查自己的代码
"eslintConfig": { "extends": "airbnb-base"}
#
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      loader: 'eslint-loader',
      options: {
            // 自动修复eslint的错误
        fix: true
      }
    }
  ]
}
```

### 代码切割

```js
1. 多入口 自动打包多个文件
   entry: {
    'jquery': './src/index.js',
    'angular': './src/2.js'
  },
2. 异部的chunk
   require.ensure([],function(_require){
     _require('./xxx')
   })
  import('./2.css').then(() => {
    ...
  })
}
#
3.
optimization: {
  splitChunks: {
    chunks: 'all'
  }
}
#
externals: {
  jquery: 'jQuery'
}
引入cdn
```

### dll

```js
#
硬链接一个 包,再手动scrit引入这个包 之后webpack就不用编译了
#
yarn add add-asset-html-webpack-plugin
webpack --config webpack.config.dll.js && webpack
# 文件路径
  webpack.config.js
  webpack.config.dll.js
  dist
     index.html
  src
  public
  dll
     jquery
     manifest.json
# webpack.config.js
const path = require('path')
const webpack = require('webpack');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin');
module.export = {
  ...
  externals: {
    jquery: 'jQuery'
  },
  plugins:[
    new HtmlWebpackPlugin({
      template: './index.html',
      filename: 'index.html',
      minify: { removeComments: true }
    }),
    // 告诉webpack哪些库不参与打包，同时使用时的名称也得变~
    new webpack.DllReferencePlugin({
        manifest: resolve(__dirname, 'dll/manifest.json')
    }),
    // 将某个文件打包输出去，并在html中自动引入该资源
    new AddAssetHtmlPlugin({
       filepath: path.resolve(__dirname, 'dll/jquery.js'),
       publicPath: '../dll',
       outputPath: 'vendor',
    }),
  ]
}
# webpack.config.dll.js
const path = require('path');
const webpack = require('webpack')
module.exports = {
  entry: {
    jquery: ['jquery'],
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dll'),
    library: '[name]_[hash]'
  },
  plugins: [
    // 打包生成一个 manifest.json --> 提供和jquery映射
    new webpack.DllPlugin({
      // 映射库的暴露的内容名称 和 library 相同
      name: '[name]_[hash]',
      path: path.join(__dirname, 'dll/manifest.json'),
    })
  ],
  mode: 'production'
};
```

```js
externals: {
    jquery: 'jQuery'
},
new webpack.ProvidePlugin({
   $: path.resolve(path.join(__dirname, 'dll/jquery.js'))
}),
```

### 更多插件

```js
# 转换语法es6
babel-loader
babel-core
babel-preset-env
# 转换es7 async
babel-plugin-transform-runtime
# 装饰器
babel-plugin-transform-decorators
babel-plugin-transform-decorators-legacy
```

## 2. 项目 eslint prettierrc 及 vscode 插件 配置

- 参考链接
- https://github.com/Hibop/Hibop.github.io/issues/34

### prettier

```js
# npm i prettier -D

# script
  "scripts": {
    "prettier": "prettier --write '**/*.{js,jsx,tsx,ts,less,md,json}'",
    "eslint": "eslint ."
  },
"lint-staged": {
    "*.{js,jsx,less,md,json}": [
      "prettier --write"
    ],
    "*.ts?(x)": [
      "prettier --parser=typescript --write"
    ]
},

# .prettierrc.js
module.exports = {
    printWidth: 80,                    //（默认值）单行代码超出 80 个字符自动换行
    tabWidth: 2,                       //（默认值）一个 tab 键缩进相当于 2 个空格
    useTabs: true,                     // 行缩进使用 tab 键代替空格
    semi: false,                       //（默认值）语句的末尾加上分号
    singleQuote: true,                 // 使用单引号
    quoteProps: 'as-needed',           //（默认值）仅仅当必须的时候才会加上双引号
    jsxSingleQuote: true,              // 在 JSX 中使用单引号
    trailingComma: 'all',              // 不用在多行的逗号分隔的句法结构的最后一行的末尾加上逗号
    bracketSpacing: true,              //（默认值）在括号和对象的文字之间加上一个空格
    jsxBracketSameLine: true,          // 把 > 符号放在多行的 JSX 元素的最后一行
    arrowParens: 'avoid',              // 当箭头函数中只有一个参数的时候可以忽略括弧
    htmlWhitespaceSensitivity: 'ignore', // vue template 中的结束标签结尾尖括号掉到了下一行
    vueIndentScriptAndStyle: false,    //（默认值）对于 .vue 文件，不缩进 <script> 和 <style> 里的内容
    embeddedLanguageFormatting: 'auto', //（默认值）允许自动格式化内嵌的代码块
};
```

### 通用配置

### .eslintignore

```markdown
**/\*.svg
**/_.ico
package.json
/dist
.DS_Store
.eslintignore
_.png
_.toml
.editorconfig
.gitignore
.prettierignore
LICENSE
.eslintcache
_.lock
yarn-error.log
/public
**/node_modules/**
.npmrc
```

### .prettierignore

```markdown
**/\*.svg
**/_.ico
package.json
/dist
.DS_Store
.eslintignore
_.png
_.toml
.editorconfig
.gitignore
.prettierignore
LICENSE
.eslintcache
_.lock
yarn-error.log
/public
**/node_modules/**
.npmrc
```

### 某文件取消 eslint 检测

- 文件开头写
- /_ eslint-disable _/

### vue2

### 使用了 vue-ui 创建项目

- 我没有勾选 eslint 及 format
- 如果选了就不用手动加 devDependencies 依赖了

### vscode 下载 eslint 插件

- npm 安装完依赖如果没效果重新启动下 eslint 插件

### vscode 下载 Prettier 插件

### vscode 设置

```json
"editor.defaultFormatter": "esbenp.prettier-vscode", //自动格式化程序为prettier
  "javascript.updateImportsOnFileMove.enabled": "always", //js重命名文件自动更新路径
  //js自动格式化程序为prettier-eslint
  "[javascript]": {
    "editor.defaultFormatter": "dbaeumer.vscode-eslint"
  },
  "[vue]": {
    "editor.defaultFormatter": "octref.vetur"
  },
  // #让vue中的js按"prettier"格式进行格式化
  "vetur.format.defaultFormatter.html": "prettier",
  "vetur.format.defaultFormatter.js": "prettier-eslint", //主要是这一行解决冲突
  "vetur.format.defaultFormatterOptions": {
    // #vue组件中html代码格式化样式
    // "js-beautify-html": {},
    // "prettier-eslint": {},
    // "prettyhtml": {}
  },
  "editor.formatOnPaste": true, //自动格式化粘贴内容
  "editor.formatOnType": true, //键入一行后自动格式化
```

### devDependencies

```json
    "eslint-config-standard": "^10.2.1",
    "eslint-friendly-formatter": "^3.0.0",
    "eslint-loader": "^1.7.1",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.7.0",
    "eslint-plugin-node": "^5.2.0",
    "eslint-plugin-promise": "^3.4.0",
    "eslint-plugin-standard": "^3.0.1",
    "@babel/core": "^7.12.16",
    "@babel/eslint-parser": "^7.12.16",
    "@vue/cli-plugin-eslint": "~5.0.0",
    "babel-eslint": "^10.1.0",
    "eslint": "^7.32.0",
    "eslint-plugin-vue": "^8.0.3"
```

### package.json

```json
{
  "eslintConfig": {
    "root": true,
    "env": {
      "node": true
    },
    "extends": ["plugin:vue/essential", "eslint:recommended"],
    "parserOptions": {
      "parser": "@babel/eslint-parser"
    },
    "rules": {}
  }
}
```

### 项目根目录新建 .eslintrc.js

```js
module.exports = {
  root: true,
  env: {
    node: true,
  },
  extends: ['plugin:vue/essential', 'eslint:recommended'],
  rules: {
    'accessor-pairs': 2,
    'arrow-spacing': [
      2,
      {
        before: true,
        after: true,
      },
    ],
    'block-spacing': [2, 'always'],
    'brace-style': [
      2,
      '1tbs',
      {
        allowSingleLine: true,
      },
    ],
    camelcase: [
      0,
      {
        properties: 'always',
      },
    ],
    'comma-dangle': [2, 'never'],
    'comma-spacing': [
      2,
      {
        before: false,
        after: true,
      },
    ],
    'comma-style': [2, 'last'],
    'constructor-super': 2,
    curly: [2, 'multi-line'],
    'dot-location': [2, 'property'],
    'eol-last': 2,
    eqeqeq: [2, 'allow-null'],
    'generator-star-spacing': [
      2,
      {
        before: true,
        after: true,
      },
    ],
    'handle-callback-err': [2, '^(err|error)$'],
    indent: [
      2,
      2,
      {
        SwitchCase: 1,
      },
    ],
    'jsx-quotes': [2, 'prefer-single'],
    'key-spacing': [
      2,
      {
        beforeColon: false,
        afterColon: true,
      },
    ],
    'keyword-spacing': [
      2,
      {
        before: true,
        after: true,
      },
    ],
    'new-cap': [
      2,
      {
        newIsCap: true,
        capIsNew: false,
      },
    ],
    'new-parens': 2,
    'no-array-constructor': 2,
    'no-caller': 2,
    'no-console': 'off',
    'no-class-assign': 2,
    'no-cond-assign': 2,
    'no-const-assign': 2,
    'no-control-regex': 2,
    'no-delete-var': 2,
    'no-dupe-args': 2,
    'no-dupe-class-members': 2,
    'no-dupe-keys': 2,
    'no-duplicate-case': 2,
    'no-empty-character-class': 2,
    'no-empty-pattern': 2,
    'no-eval': 2,
    'no-ex-assign': 2,
    'no-extend-native': 2,
    'no-extra-bind': 2,
    'no-extra-boolean-cast': 2,
    'no-extra-parens': [2, 'functions'],
    'no-fallthrough': 2,
    'no-floating-decimal': 2,
    'no-func-assign': 2,
    'no-implied-eval': 2,
    'no-inner-declarations': [2, 'functions'],
    'no-invalid-regexp': 2,
    'no-irregular-whitespace': 2,
    'no-iterator': 2,
    'no-label-var': 2,
    'no-labels': [
      2,
      {
        allowLoop: false,
        allowSwitch: false,
      },
    ],
    'no-lone-blocks': 2,
    'no-mixed-spaces-and-tabs': 2,
    'no-multi-spaces': 2,
    'no-multi-str': 2,
    'no-multiple-empty-lines': [
      2,
      {
        max: 1,
      },
    ],
    'no-native-reassign': 2,
    'no-negated-in-lhs': 2,
    'no-new-object': 2,
    'no-new-require': 2,
    'no-new-symbol': 2,
    'no-new-wrappers': 2,
    'no-obj-calls': 2,
    'no-octal': 2,
    'no-octal-escape': 2,
    'no-path-concat': 2,
    'no-proto': 2,
    'no-redeclare': 2,
    'no-regex-spaces': 2,
    'no-return-assign': [2, 'except-parens'],
    'no-self-assign': 2,
    'no-self-compare': 2,
    'no-sequences': 2,
    'no-shadow-restricted-names': 2,
    'no-spaced-func': 2,
    'no-sparse-arrays': 2,
    'no-this-before-super': 2,
    'no-throw-literal': 2,
    'no-trailing-spaces': 2,
    'no-undef': 2,
    'no-undef-init': 2,
    'no-unexpected-multiline': 2,
    'no-unmodified-loop-condition': 2,
    'no-unneeded-ternary': [
      2,
      {
        defaultAssignment: false,
      },
    ],
    'no-unreachable': 2,
    'no-unsafe-finally': 2,
    'no-unused-vars': [
      2,
      {
        vars: 'all',
        args: 'none',
      },
    ],
    'no-useless-call': 2,
    'no-useless-computed-key': 2,
    'no-useless-constructor': 2,
    'no-useless-escape': 0,
    'no-whitespace-before-property': 2,
    'no-with': 2,
    'one-var': [
      2,
      {
        initialized: 'never',
      },
    ],
    'operator-linebreak': [
      2,
      'after',
      {
        overrides: {
          '?': 'before',
          ':': 'before',
        },
      },
    ],
    'padded-blocks': [2, 'never'],
    quotes: [
      2,
      'single',
      {
        avoidEscape: true,
        allowTemplateLiterals: true,
      },
    ],
    semi: [2, 'always'], // 语句强制分号结尾
    'space-before-blocks': [2, 'always'],
    'space-before-function-paren': [2, 'never'],
    'space-in-parens': [2, 'never'],
    'space-infix-ops': 2,
    'space-unary-ops': [
      2,
      {
        words: true,
        nonwords: false,
      },
    ],
    'spaced-comment': [
      2,
      'always',
      {
        markers: [
          'global',
          'globals',
          'eslint',
          'eslint-disable',
          '*package',
          '!',
          ',',
        ],
      },
    ],
    'template-curly-spacing': [2, 'never'],
    'use-isnan': 2,
    'valid-typeof': 2,
    'wrap-iife': [2, 'any'],
    'yield-star-spacing': [2, 'both'],
    yoda: [2, 'never'],
    'prefer-const': 2,
    'no-debugger': process.env.NODE_ENV === 'production' ? 2 : 0,
    'object-curly-spacing': [
      2,
      'always',
      {
        objectsInObjects: false,
      },
    ],
    'array-bracket-spacing': [2, 'never'],
  },
  parserOptions: {
    parser: 'babel-eslint',
  },
};
```

### 如果报错提示 babel-eslint

- 一块重新卸载和安装下
- npm uninstall eslint babel-eslint -g
- npm install eslint babel-eslint -g

### 测试效果

```js
# HomeView.vue
let a;
# 此时会提示 'a' is defined but never used.eslintno-unused-vars
```

### vue3

### 使用 vue-ui 创建项目

- 我没有勾选 eslint 及 format
- 如果选了就不用手动加 devDependencies 依赖了

### 依赖

```js
    "@typescript-eslint/eslint-plugin": "^5.32.0",
    "@typescript-eslint/parser": "^5.32.0",
    "@vue/cli-plugin-babel": "~5.0.0",
    "@vue/cli-plugin-eslint": "~5.0.0",
    "@vue/eslint-config-standard": "^6.1.0",
    "@vue/eslint-config-typescript": "^9.1.0",
    "eslint": "^8.21.0",
    "eslint-define-config": "^1.6.0",
    "eslint-plugin-import": "^2.25.3",
    "eslint-plugin-node": "^11.1.0",
    "eslint-plugin-prettier": "^4.2.1",
    "eslint-plugin-promise": "^5.1.0",
    "eslint-plugin-vue": "^9.3.0",
    "eslint-config-prettier": "^8.5.0",
    "prettier-eslint": "^15.0.1",
```

- eslint --init

### .eslintrc.js

```js
/* eslint-disable */
const { defineConfig } = require('eslint-define-config');
module.exports = defineConfig({
  root: true,
  env: {
    browser: true,
    node: true,
    es6: true,
  },
  parser: 'vue-eslint-parser',
  parserOptions: {
    parser: '@typescript-eslint/parser',
    ecmaVersion: 2020,
    sourceType: 'module',
    jsxPragma: 'React',
    ecmaFeatures: {
      jsx: true,
    },
  },
  extends: [
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier',
    'plugin:prettier/recommended',
  ],
  rules: {
    'vue/script-setup-uses-vars': 'error',
    '@typescript-eslint/ban-ts-ignore': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/no-explicit-any': 'off',
    '@typescript-eslint/no-var-requires': 'off',
    '@typescript-eslint/no-empty-function': 'off',
    'vue/custom-event-name-casing': 'off',
    'no-use-before-define': 'off',
    '@typescript-eslint/no-use-before-define': 'off',
    '@typescript-eslint/ban-ts-comment': 'off',
    '@typescript-eslint/ban-types': 'off',
    '@typescript-eslint/no-non-null-assertion': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/no-unused-vars': [
      'error',
      {
        argsIgnorePattern: '^_',
        varsIgnorePattern: '^_',
      },
    ],
    'no-unused-vars': [
      'error',
      {
        argsIgnorePattern: '^_',
        varsIgnorePattern: '^_',
      },
    ],
    'space-before-function-paren': 'off',

    'vue/attributes-order': 'off',
    'vue/one-component-per-file': 'off',
    'vue/html-closing-bracket-newline': 'off',
    'vue/max-attributes-per-line': 'off',
    'vue/multiline-html-element-content-newline': 'off',
    'vue/singleline-html-element-content-newline': 'off',
    'vue/attribute-hyphenation': 'off',
    'vue/require-default-prop': 'off',
    'vue/html-self-closing': [
      'error',
      {
        html: {
          void: 'always',
          normal: 'never',
          component: 'always',
        },
        svg: 'always',
        math: 'always',
      },
    ],
  },
});
```

### 测试效果

- 此时 let a 就会报错了
- 提示没有使用

### umi

```js
# devDependencies
  // nvm用最新的node
  // nvm install nvm use lts/fermium
  // nvm use lts/fermium
    "@typescript-eslint/eslint-plugin": "^5.32.0",
    "@typescript-eslint/parser": "^5.32.0",
    "@umijs/fabric": "^2.2.2",
    "eslint-plugin-unicorn": "^43.0.2",
    "eslint": "^8.21.0",
    "eslint-plugin-jest": "^26.7.0",
    "eslint-plugin-react": "^7.30.1",
    "eslint-plugin-react-hooks": "^4.6.0",
# eslint --init
# .eslintrc.js
module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/eslint')],
};
# vscode
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.codeActionsOnSave": {
      "source.fixAll.eslint": false
    }
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.codeActionsOnSave": {
      "source.fixAll.eslint": false
    }
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.codeActionsOnSave": {
      "source.fixAll.eslint": false
    }
  },
```

## 3. node 脚本自动注入路由

- https://github.com/eternallycyf/node-script-router-inject-demo

## 4. browserslistrc

### 配置浏览器兼容性

```js
# 注释是这样写的，以#号开头
last 1 version #最后的一个版本
> 1%  #代表全球超过1%使用的浏览器
maintained node versions #所有还被 node 基金会维护的 node 版本
not dead
```

### 配置

```bash
> 5%: 基于全球使用率统计而选择的浏览器版本范围。>=,<,<=同样适用。
> 5% in US : 同上，只是使用地区变为美国。支持两个字母的国家码来指定地区。
> 5% in alt-AS : 同上，只是使用地区变为亚洲所有国家。这里列举了所有的地区码。
> 5% in my stats : 使用定制的浏览器统计数据。
cover 99.5% : 使用率总和为99.5%的浏览器版本，前提是浏览器提供了使用覆盖率。
cover 99.5% in US : 同上，只是限制了地域，支持两个字母的国家码。
cover 99.5% in my stats :使用定制的浏览器统计数据。
maintained node versions :所有还被 node 基金会维护的 node 版本。
node 10 and node 10.4 : 最新的 node 10.x.x 或者10.4.x 版本。
current node :当前被 browserslist 使用的 node 版本。
extends browserslist-config-mycompany :来自browserslist-config-mycompany包的查询设置
ie 6-8 : 选择一个浏览器的版本范围。
Firefox > 20 : 版本高于20的所有火狐浏览器版本。>=,<,<=同样适用。
ios 7 :ios 7自带的浏览器。
Firefox ESR :最新的火狐 ESR（长期支持版） 版本的浏览器。
unreleased versions or unreleased Chrome versions : alpha 和 beta 版本。
last 2 major versions or last 2 ios major versions :最近的两个发行版，包括所有的次版本号和补丁版本号变更的浏览器版本。
since 2015 or last 2 years :自某个时间以来更新的版本（也可以写的更具体since 2015-03或者since 2015-03-10）
dead :通过last 2 versions筛选的浏览器版本中，全球使用率低于0.5%并且官方声明不在维护或者事实上已经两年没有再更新的版本。目前符合条件的有 IE10,IE_Mob 10,BlackBerry 10,BlackBerry 7,OperaMobile 12.1。
last 2 versions :每个浏览器最近的两个版本。
last 2 Chrome versions :chrome 浏览器最近的两个版本。
defaults :默认配置> 0.5%, last 2 versions, Firefox ESR, not dead。
not ie <= 8 : 浏览器范围的取反。
可以添加not在任和查询条件前面，表示取反
```

### demo

- .browserslistrc

```bash
[production staging]
> 1%
ie 10

[development]
last 1 chrome version
last 1 firefox version

```

## 5. commitlint.config.js

### commit 规则

https://www.jianshu.com/p/c7e40dab5b05

### 配置

```js
yarn add commitizen --dev
npx commitizen init cz-conventional-changelog --yarn --dev
# scripts
"scripts": {
  "commit": "git-cz"
}
#
yarn commit
```

### 强制采用

```js
yarn add @commitlint/config-conventional @commitlint/cli --dev
# commitlint.config.js
// feat：新增功能
// fix：bug 修复
// docs：文档更新
// style：不影响程序逻辑的代码修改(修改空白字符，格式缩进，补全缺失的分号等，没有改变代码逻辑)
// refactor：重构代码(既没有新增功能，也没有修复 bug)
// perf：性能, 体验优化
// test：新增测试用例或是更新现有测试
// build：主要目的是修改项目构建系统(例如 glup，webpack，rollup 的配置等)的提交
// ci：主要目的是修改项目继续集成流程(例如 Travis，Jenkins，GitLab CI，Circle等)的提交
// chore：不属于以上类型的其他类，比如构建流程, 依赖管理
// revert：回滚某个更早之前的提交

module.exports = {
  ignores: [(commit) => commit.includes('init')],
  extends: ['@commitlint/config-conventional'],
  rules: {
    'body-leading-blank': [2, 'always'],
    'footer-leading-blank': [1, 'always'],
    'header-max-length': [2, 'always', 108],
    'subject-empty': [2, 'never'],
    'type-empty': [2, 'never'],
    'subject-case': [0],
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'perf',
        'style',
        'docs',
        'test',
        'refactor',
        'build',
        'ci',
        'chore',
        'revert',
        'wip',
        'workflow',
        'types',
        'release',
      ],
    ],
  },
};

```

### husky

```js
yarn add husky --dev
# package.json
  "husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  }
```

### demo

```js
// feat：新增功能
// fix：bug 修复
// docs：文档更新
// style：不影响程序逻辑的代码修改(修改空白字符，格式缩进，补全缺失的分号等，没有改变代码逻辑)
// refactor：重构代码(既没有新增功能，也没有修复 bug)
// perf：性能, 体验优化
// test：新增测试用例或是更新现有测试
// build：主要目的是修改项目构建系统(例如 glup，webpack，rollup 的配置等)的提交
// ci：主要目的是修改项目继续集成流程(例如 Travis，Jenkins，GitLab CI，Circle等)的提交
// chore：不属于以上类型的其他类，比如构建流程, 依赖管理
// revert：回滚某个更早之前的提交

module.exports = {
  ignores: [commit => commit.includes('init')],
  extends: ['@commitlint/config-conventional'],
  rules: {
    'body-leading-blank': [2, 'always'],
    'footer-leading-blank': [1, 'always'],
    'header-max-length': [2, 'always', 108],
    'subject-empty': [2, 'never'],
    'type-empty': [2, 'never'],
    'subject-case': [0],
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'perf',
        'style',
        'docs',
        'test',
        'refactor',
        'build',
        'ci',
        'chore',
        'revert',
        'wip',
        'workflow',
        'types',
        'release',
      ],
    ],
  },
};
```

## 6. gitattributes

- `.gitattributes`
- 将 `github` 的仓库识别语言的 `js` 文件全部变成 `ts`

```bash
*.tsx linguist-language=typescript
*.js linguist-language=typescript
*.css linguist-language=typescript
*.less linguist-language=typescript
* -text
```

## 7. License

### Apache 许可证

- 允许修改代码 二次开源
- 条件
  - 需要给代码的用户一份`Apache License`
  - 如果你修改了代码，需要在被修改的文件中说明
  - 商业软件可以使用，也可以修改使用 Apache 协议的代码

### BSD 许可证

- 如果再发布的产品中包含源代码，则在源代码中必须带有原来代码中的 BSD 协 议
- 不可以用开源代码的作者/机构名字和原来产品的名字做市场推广
- 商业软件可以使用，也可以修改使用 BSD 协议的代码

### GUN 许可证

- GPL 赋予和保证了开源项目开发者广泛的权利。
- 基本上，它允许用户合法复制，分发和修改软件
- 商业软件不能使用 GPL 协议的代码。

### MIT 许可证

- 你必须在你的发行版里包含原许可协议的声明,无论你是以二进制发布的还是以源代码发布的。
- 你可以使用，复制和修改软件
- 你可以免费使用软件或出售
- 唯一的限制是，它是必须附有 MIT 授权协议
- 商业软件可以使用，也可以修改 MIT 协议的代码，甚至可以出售 MIT 协议的代码
- 使用 MIT 的软件项目有: jquery、Node.js

### MPL 许可证

- 允许免费重发布、免费修改，但要求修改后的代码版权归软件的发起者
- 商业软件可以使用，也可以修改 MPL 协议的代码，但修改后的代码版权归软件的发起者
- 使用 GPL 的最著名的软件项目是: Linux

### CDDL 许可证

- 是 MPL 的扩展协议
- 它允许公共版权使用，无专利费，并提供专利保护，可集成于商业软件中，允许自行发布许可
- 商业软件可以使用，也可以修改 CDDL 协议的代码

### EPL 许可证

- 与 CPL 相类似的许可证，任何扩展自 Eclipse 源码的代码也必须是开源的

### CC 许可证

- 不常开放源代码授权

### Common Public License 1.0

- 商业软件可以使用，也可以修改 Common 协议的代码，但要承担代码产生的侵权责任。

## 8. npmrc

```js
# 提升一些依赖包至 node_modules
# 解决部分包模块not found的问题
# 用于配合 pnpm
shamefully-hoist = true

# node-sass 下载问题
# sass_binary_site="https://npm.taobao.org/mirrors/node-sass/"

home=https://npm.taobao.org
registry=https://registry.npm.taobao.org/
sass_binary_site="https://npm.taobao.org/mirrors/node-sass/"
phantomjs_cdnurl="http://cnpmjs.org/downloads"
electron_mirror="https://npm.taobao.org/mirrors/electron/"
sqlite3_binary_host_mirror="https://foxgis.oss-cn-shanghai.aliyuncs.com/"
profiler_binary_host_mirror="https://npm.taobao.org/mirrors/node-inspector/"
chromedriver_cdnurl="https://cdn.npm.taobao.org/dist/chromedriver"
```

## 9. stylelintrc

- .stylelintrc.js
- https://zhuanlan.zhihu.com/p/493920283

```js
module.exports = {
  ignoreFiles: [],
  extends: [
    'stylelint-config-standard',
    'stylelint-config-rational-order',
    'stylelint-prettier/recommended',
  ],
  plugins: ['stylelint-scss', 'stylelint-color-format'],
  rules: {
    indentation: 'tab',
    'rule-empty-line-before': 'never',
    'selector-type-no-unknown': null,
    'selector-type-case': null,
    'no-descending-specificity': null, //[true, { ignore: ['selectors-within-list'] }],
    'selector-list-comma-newline-after': 'always-multi-line',
    'value-keyword-case': null,
    'function-name-case': null,
    'at-rule-no-unknown': null,
    'color-format/format': {
      format: 'rgba',
    },
  },
};
```

## 10. tsconfig

```json
"compilerOptions": {
  "incremental": true, // TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度
  "tsBuildInfoFile": "./buildFile", // 增量编译文件的存储位置
  "diagnostics": true, // 打印诊断信息
  "target": "ES5", // 目标语言的版本
  "module": "CommonJS", // 生成代码的模板标准
  "outFile": "./app.js", // 将多个相互依赖的文件生成一个文件，可以用在AMD模块中，即开启时应设置"module": "AMD",
  "lib": ["DOM", "ES2015", "ScriptHost", "ES2019.Array"], // TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入"ES2019.Array",
  "allowJS": true, // 允许编译器编译JS，JSX文件
  "checkJs": true, // 允许在JS文件中报错，通常与allowJS一起使用
  "outDir": "./dist", // 指定输出目录
  "rootDir": "./", // 指定输出文件目录(用于输出)，用于控制输出目录结构
  "declaration": true, // 生成声明文件，开启后会自动生成声明文件
  "declarationDir": "./file", // 指定生成声明文件存放目录
  "emitDeclarationOnly": true, // 只生成声明文件，而不会生成js文件
  "sourceMap": true, // 生成目标文件的sourceMap文件
  "inlineSourceMap": true, // 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中
  "declarationMap": true, // 为声明文件生成sourceMap
  "typeRoots": [], // 声明文件目录，默认时node_modules/@types
  "types": [], // 加载的声明文件包
  "removeComments":true, // 删除注释
  "noEmit": true, // 不输出文件,即编译后不会生成任何js文件
  "noEmitOnError": true, // 发送错误时不输出任何文件
  "noEmitHelpers": true, // 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用
  "importHelpers": true, // 通过tslib引入helper函数，文件必须是模块
  "downlevelIteration": true, // 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现
  "strict": true, // 开启所有严格的类型检查
  "jsx": "preserve", // 指定 jsx 格式
  "alwaysStrict": true, // 在代码中注入'use strict'
  "noImplicitAny": true, // 不允许隐式的any类型
  "strictNullChecks": true, // 不允许把null、undefined赋值给其他类型的变量
  "strictFunctionTypes": true, // 不允许函数参数双向协变
  "strictPropertyInitialization": true, // 类的实例属性必须初始化
  "strictBindCallApply": true, // 严格的bind/call/apply检查
  "noImplicitThis": true, // 不允许this有隐式的any类型
  "noUnusedLocals": true, // 检查只声明、未使用的局部变量(只提示不报错)
  "noUnusedParameters": true, // 检查未使用的函数参数(只提示不报错)
  "noFallthroughCasesInSwitch": true, // 防止switch语句贯穿(即如果没有break语句后面不会执行)
  "noImplicitReturns": true, //每个分支都会有返回值
  "esModuleInterop": true, // 允许export=导出，由import from 导入
  "allowUmdGlobalAccess": true, // 允许在模块中全局变量的方式访问umd模块
  "moduleResolution": "node", // 模块解析策略，ts默认用node的解析策略，即相对的方式导入
  "baseUrl": "./", // 解析非相对模块的基地址，默认是当前目录
  "paths": { // 路径映射，相对于baseUrl
    // 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置
    "jquery": ["node_modules/jquery/dist/jquery.min.js"]
  },
  "rootDirs": ["src","out"], // 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错
  "listEmittedFiles": true, // 打印输出文件
  "listFiles": true// 打印编译的文件(包括引用的声明文件)
}
```
